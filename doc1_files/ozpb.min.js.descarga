var consentZones={GDPR:"GDPR",USP:"USP",NONE:"NONE"},THIS_CONSENT_ZONE=consentZones.NONE;function getQuerystringConsentZone(){var e=document.location.search.match("consent_zone=[a-zA-Z]+");return!!e&&e[0].split("=")[1].toUpperCase()}var adunitsFile,ozonePluginFile,configVars={adunitsFile_src:"https://prebid.the-ozone-project.com/hw2/OZONEBBC4784/1500000107/current/adUnits.min.js",ozpbPluginUrl:"https://prebid.the-ozone-project.com/hw2/OZONEBBC4784/1500000107/current/customized_plugin.js",ozonePrebidFile_src:"https://prebid.the-ozone-project.com/hw2/builds/ozwrap_pbjs.js",sizeMappingV2:!0,prebidSingleRequest:!0,prebidEnableSendAllBids:!0,userIds:[{storage:{expires:365,type:"html5",name:"_pubcid"},name:"sharedId"}],PREBID_TIMEOUT:2e3,PREBID_BACKSTOP_TIMEOUT:3e3,pbjsDebug:document.location.search.match("pbjs_debug=true"),CONSENT_ZONE:getQuerystringConsentZone()||THIS_CONSENT_ZONE,callbackArg:"ozone",refresh:{fetchBids:!1,callAdserverUntilMs:null},disableInitialLoad:!1,requestBidsOnEnableServices:!0,prebidEnableGDPR:!0,prebidEnableUSP:!0,prebidDefaultGdprScope:!1,prebidGdprTimeoutMs:1e4,prebidGdprCmpApi:"iab",prebidUspTimeoutMs:1e4,prebidUspCmpApi:"iab",prebidUseBidCache:!1,useDfpTargeting:!0,addTestgroupKey:!0,testgroupKeyName:"testgroup",testgroupVal:Math.floor(99*Math.random()),sendGpid:!1,batchRequests:!0,slotRefresh:null,rtdProviders:[{name:"permutive",waitForIt:!0,params:{acBidders:["ozone"],maxSegs:500}}],rtdAuctionDelay:50,ozoneAuctionUrl:null,ozoneRendererUrl:null,ozoneCookieSyncUrl:null,enhancedAdserverTargeting:!0,ozWhitelistAdserverKeys:null,coppa:!1,ozPageType:null,ozSectionValue:null,adunitsUseSlotSizes:null,tooLateToCallRefresh:function(){return 0<configVars.refresh.callAdserverUntilMs&&configVars.getElapsedMs()>configVars.refresh.callAdserverUntilMs},allOk:!0,startTime:Date.now(),getElapsedMs:function(){return Date.now()-configVars.startTime},adunitCodeMatch:"[slot]",syncDelay:3e3};function ozoneLog(){if(configVars.pbjsDebug){let e=1<arguments.length?arguments:arguments[0];console.log(`%cOZONE wrapper : ${configVars.getElapsedMs()}ms`,"background-color: #9B9; border-radius:5px; padding: 3px;",e)}}function ozoneError(){if(configVars.pbjsDebug){let e=1<arguments.length?arguments:arguments[0];console.error(`%cOZONE wrapper :  ${configVars.getElapsedMs()}ms`,"background-color: #B99; border-radius:5px; padding: 3px;",e)}}function setupAdunitsObject(){if(ozoneLog("setupAdunitsObject called"),!window.ozAdUnits)return ozoneError("NO ozAdUnits are specified!!! cannot continue! Auction will not work!"),!1;let o=[];ozoneLog(`setupAdunitsObject Executing ${(o=window.hasOwnProperty("ozoneadunits")?ozoneadunits.cmd:o).length} stored up commands.`);for(let e=0;e<o.length;e++)ozoneLog("setupAdunitsObject Executing pushed command no."+e),o[e]();window.ozoneadunits={cmd:{push:function(e){ozoneLog("ozoneadunits.push called, will execute the command now."),e()},unshift:function(e){ozoneLog("ozoneadunits.unshift called, will execute the command now."),e()}}}}function setupPluginObject(){ozoneLog("setupPluginObject called");let o=[];ozoneLog(`setupPluginObject Executing ${(o=window.hasOwnProperty("ozoneplugin")?ozoneplugin.cmd:o).length} stored up commands.`);for(let e=0;e<o.length;e++)ozoneLog("setupPluginObject Executing pushed command no."+e),o[e]();window.ozoneplugin={cmd:{push:function(e){ozoneLog("ozoneplugin.push called, will execute the command now."),e()},unshift:function(e){ozoneLog("ozoneplugin.unshift called, will execute the command now."),e()}}}}window.ozwrap_pbjs=window.ozwrap_pbjs||{},ozwrap_pbjs.que=ozwrap_pbjs.que||[],window.ozonePageConfig?(ozoneLog("FOUND ozonePageConfig. Assigning all keys/values into our configVars"),Object.assign(configVars,ozonePageConfig)):ozoneLog("did not find var ozonePageConfig in the page - it's no biggie, unless you want to override the default config."),Array.isArray(configVars.rtdProviders)||(ozoneError("configVars.rtdProviders is not an array. Will use [] as rtdProviders. Please see config requirements for specifying rtd providers."),configVars.rtdProviders=[]),"number"!=typeof configVars.rtdAuctionDelay&&(ozoneError("configVars.rtdAuctionDelay is not a number. Will use 50 as default."),configVars.rtdAuctionDelay=50),window.ozoneadunits=window.ozoneadunits||{},ozoneadunits.cmd=ozoneadunits.cmd||[],window.ozoneplugin=window.ozoneplugin||{},window.ozoneplugin.cmd=window.ozoneplugin.cmd||[],configVars.adunitsFile_src?((adunitsFile=document.createElement("script")).onload=setupAdunitsObject,adunitsFile.src=configVars.adunitsFile_src,document.head.appendChild(adunitsFile),ozoneLog("adunits loader: after writing script tag to include adunits.js")):(ozoneLog("**** "),ozoneLog("**** [WARNING] NO configVars.adunitsFile_src HAS BEEN SPECIFIED! Header bidding will continue but if you forgot to include adunits then it will fail"),ozoneLog("**** "),setupAdunitsObject()),configVars.ozpbPluginUrl?((ozonePluginFile=document.createElement("script")).onload=setupPluginObject,ozonePluginFile.src=configVars.ozpbPluginUrl,document.head.appendChild(ozonePluginFile),ozoneLog("ozpb.js: after writing script tag to include plugin file from "+configVars.ozpbPluginUrl)):(ozoneError("**** "),ozoneError("**** NO configVars.ozpbPluginUrl HAS BEEN SPECIFIED! OZPB HEADER BIDDING WILL NOT BE ACTIVATED!! Get devs to check this integration."),ozoneError("**** "),configVars.allOk=!1),window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[];var ozonePrebidFile,ozonePubads={cachePubads:null,cachedResponse:null,originalFn:null,_callbackRefresh:{},setRefreshFnForSlots:function(e,o){e=ozoneWrapper.getDivIdsForSlots(e),e=ozoneWrapper.getKeyForArrDivIds(e);ozoneLog(`setRefreshFnForSlots got key ${e} going to set `,o),ozonePubads._callbackRefresh[e]=o},getRefreshFnForDivIds:function(e){e=ozoneWrapper.getKeyForArrDivIds(e);return ozoneLog(`getRefreshFnForDivIds got key ${e} going to return ${typeof ozonePubads._callbackRefresh[e]} `,ozonePubads._callbackRefresh[e]),ozonePubads._callbackRefresh[e]},getBidsAndRefreshCorrectly:function(){configVars.refresh.fetchBids&&!configVars.tooLateToCallRefresh()?(ozoneLog("requestBidsOnEnableServices: going to call googletag.pubads().refresh()"),googletag.pubads().refresh()):(ozoneLog("requestBidsOnEnableServices: going to call ozoneWrapper.ozoneFetchBids()"),ozoneWrapper.ozoneFetchBids())}},ozoneWrapper=(configVars.allOk&&window.googletag.cmd.push(function(){var o,n=window.googletag;n.enableServices?(configVars.disableInitialLoad&&(ozoneLog("disabling initialLoad"),window.googletag.pubads().disableInitialLoad()),configVars.requestBidsOnEnableServices?(ozoneLog("Going to capture gpt.enableServices"),o=n.enableServices,n.enableServices=function(){ozoneLog("googletag.enableServices has been called!");var e=o.apply(n,arguments);if(configVars.CONSENT_ZONE===consentZones.GDPR){ozoneLog("we have been told explicitly that we are definitely in a GDPR area. This is different to just enabling prebid.setConfig gdpr.");try{__tcfapi("addEventListener",2,function(e,o){ozoneLog("ozone __tcfapi listener callback: cmp responded:",e,o),-1<["useractioncomplete","tcloaded"].indexOf(e.eventStatus)||!e.gdprApplies?(ozoneLog(`eventStatus "${e.eventStatus}" combined with gdprApplies ${e.gdprApplies} is ok - going to call ozoneFetchBids now`),ozoneadunits.cmd.push(function(){ozoneplugin.cmd.push(function(){ozonePubads.getBidsAndRefreshCorrectly()})})):ozoneLog("wrong eventStatus, will not call ozoneFetchBids yet")})}catch(e){ozoneError("GDPR zone, we tried to push ozoneFetchBids inside a __tcfapi callback but there was an error: ",e),ozoneLog("going to call ozoneFetchBids in a separate thread in case there are no ads on page load"),setTimeout(function(){ozoneadunits.cmd.push(function(){ozoneplugin.cmd.push(function(){ozonePubads.getBidsAndRefreshCorrectly()})})},1)}}else ozoneLog("NOT specified as being gdpr area, going to call ozoneFetchBids now:"),ozoneLog("going to call ozoneFetchBids in a separate thread in case there are no ads on page load"),setTimeout(function(){ozoneadunits.cmd.push(function(){ozoneplugin.cmd.push(function(){ozonePubads.getBidsAndRefreshCorrectly()})})},1);return ozoneLog("going to return from googletag.enableServices"),e},ozoneLog("ozone captured googletag.enableServices")):ozoneLog("Will not capture enableServices - we are not going to request bids on enableServices"),configVars.refresh.fetchBids?(ozoneLog("capturing googletag.pubads().refresh()"),ozonePubads.cachedResponse=window.googletag.pubads(),ozonePubads.originalFn=ozonePubads.cachedResponse.refresh,ozoneLog("cached response:",ozonePubads.cachedResponse),ozonePubads.cachePubads=function(){return ozonePubads.cachedResponse.refresh=function(){var o=arguments;if(configVars.tooLateToCallRefresh())ozoneLog(`Refresh: MORE than ${configVars.refresh.callAdserverUntilMs}ms have elapsed; will just pass through the refresh call for `,o),ozonePubads.originalFn.apply(ozonePubads.cachedResponse,o);else{ozoneLog(`Refresh: ${configVars.getElapsedMs()}ms have passed. inside refresh(), about to store the callback (intercepted refresh) then fire off the auction. Args received: `,o);let e=0===o.length?[]:o[0];ozonePubads.setRefreshFnForSlots(e,function(){ozoneLog("Executing the stored refresh function, calling to refresh slots: "+e.map(e=>e?e.getSlotElementId():"undefined")),ozonePubads.originalFn.apply(ozonePubads.cachedResponse,o)}),setTimeout(function(){0<o.length?ozoneWrapper.ozoneFetchBids(ozoneWrapper.getDivIdsForSlots(o[0])):ozoneWrapper.ozoneFetchBids()},0)}return!0},ozonePubads.cachedResponse},window.googletag.pubads=ozonePubads.cachePubads):ozoneLog("Not going to capture refresh - we will not get ads for refresh calls.")):ozoneError("could not bind to gpt googletag api")}),configVars.ozonePrebidFile_src?((ozonePrebidFile=document.createElement("script")).src=configVars.ozonePrebidFile_src,document.head.appendChild(ozonePrebidFile),ozoneLog("ozpb.js: after writing script tag to include prebid file")):(ozoneError("**** CANNOT LOAD PREBID FILE - prebid url is set to nothing!"),configVars.allOk=!1),configVars.allOk?window.ozwrap_pbjs.que.push(function(){var e={coppa:configVars.coppa,ozone:{singleRequest:configVars.prebidSingleRequest,enhancedAdserverTargeting:configVars.enhancedAdserverTargeting},enableSendAllBids:configVars.prebidEnableSendAllBids,useBidCache:configVars.prebidUseBidCache,bidderTimeout:configVars.PREBID_TIMEOUT,mediaTypePriceGranularity:{video:"auto","video-outstream":"auto",banner:"auto"},userSync:{userIds:configVars.userIds,filterSettings:{iframe:{bidders:"*",filter:"include",iframeEnabled:!0}},syncDelay:configVars.syncDelay}},o={};configVars.ozoneAuctionUrl&&(o.auctionUrl=configVars.ozoneAuctionUrl),configVars.ozoneRendererUrl&&(o.rendererUrl=configVars.ozoneRendererUrl),configVars.ozoneCookieSyncUrl&&(o.cookieSyncUrl=configVars.ozoneCookieSyncUrl),0<Object.keys(o).length&&(e.ozone.endpointOverride=o),configVars.ozWhitelistAdserverKeys&&("string"==typeof configVars.ozWhitelistAdserverKeys&&(configVars.ozWhitelistAdserverKeys=str_replace(" ","",configVars.ozWhitelistAdserverKeys).split(",")),e.ozone.oz_whitelist_adserver_keys=configVars.ozWhitelistAdserverKeys),0<configVars.rtdProviders.length&&(e.realTimeData={auctionDelay:configVars.rtdAuctionDelay,dataProviders:configVars.rtdProviders}),configVars.sizeMappingV2?ozoneLog("Will not set ozwrap_pbjs.sizeConfig - we're using sizeMappingV2"):(ozoneLog("setting ozwrap_pbjs.sizeConfig"),e.sizeConfig=configVars.prebidSizeConfig),configVars.prebidEnableGDPR&&(ozoneLog("setting prebid config: GDPR"),e.consentManagement={},e.consentManagement.gdpr={rules:[{purpose:"storage",enforcePurpose:!0,enforceVendor:!0,vendorExceptions:["permutive"]},{purpose:"basicAds",enforcePurpose:!0,enforceVendor:!0,vendorExceptions:[]}],cmpApi:configVars.prebidGdprCmpApi,allowAuctionWithoutConsent:!0,timeout:configVars.prebidGdprTimeoutMs,defaultGdprScope:configVars.prebidDefaultGdprScope}),configVars.prebidEnableUSP&&(ozoneLog("setting prebid config: USP"),e.consentManagement=e.consentManagement||{},e.consentManagement.usp={cmpApi:configVars.prebidUspCmpApi,timeout:configVars.prebidUspTimeoutMs}),!1===configVars.sendGpid?e.gptPreAuction={enabled:!1}:e.gptPreAuction={enabled:!0,useDefaultPreAuction:!0},ozoneLog("setting gptPreAuction to "+e.gptPreAuction.enabled),configVars.batchRequests?(e.ozone.batchRequests=!0,ozoneLog("setting batchRequests to true")):e.ozone.batchRequests=!1,configVars.extraConfig&&(ozoneLog("configVars.extraConfig is set, will merge the extra object into pbjs config"),Object.assign(e,configVars.extraConfig)),window.ozwrap_pbjs.setConfig(e);let n=[];ozoneLog(`ozoneWrapper.cmd Executing ${(n=Array.isArray(ozoneWrapper.cmd)?ozoneWrapper.cmd:n).length} stored up commands.`);for(let e=0;e<n.length;e++)ozoneLog("ozoneWrapper.cmd Executing pushed command no."+e),n[e]();ozoneWrapper.cmd={push:function(e){e()}}}):ozoneError("configVars.allOk is FALSE: no ozone header bidding will happen"),{cmd:[],_arrAdserverRequestSent:{},getKeyForArrDivIds:function(e){e=e||[],Array.isArray(e)||(e=[e]);let o="all";return o=0<e.length?"key_"+e.join("_"):o},setAdserverRequestSent:function(e,o){e=ozoneWrapper.getKeyForArrDivIds(e);ozoneLog(`setting ozoneWrapper._arrAdserverRequestSent[${e}] to : `+o),ozoneWrapper._arrAdserverRequestSent[e]=o},getAdserverRequestSent:function(e){e=ozoneWrapper.getKeyForArrDivIds(e);let o=!1;return ozoneLog(`getting ozoneWrapper._arrAdserverRequestSent[${e}] found value to return: `+(o=ozoneWrapper._arrAdserverRequestSent.hasOwnProperty(e)?ozoneWrapper._arrAdserverRequestSent[e]:o)),o},setCustomGptKeys:function(){var e,o=Object.keys(ozwrap_pbjs.getBidResponses());for(e of ozoneWrapper.getGoogletagSlotsForDivIds(o))e.setTargeting("oz_wrap","true");if(configVars.addTestgroupKey)for(var n of googletag.pubads().getSlots())n.setTargeting(configVars.testgroupKeyName,configVars.testgroupVal)},startPrebidTimeout:function(e,o,n){ozoneLog("startPrebidTimeout called with ms value: "+e),ozoneWrapper.getAdserverRequestSent(o)?ozoneLog("startPrebidTimeout - ads have already been requested, will not call for ads."):ozoneadunits.cmd.push(function(){ozoneLog(`(inside ozoneadunits.cmd fn) Setting a timeout to call sendAdserverRequest after ${e}ms`),setTimeout(function(){ozoneWrapper.getAdserverRequestSent(o)?ozoneLog("prebid auction timeout handler - ads have already been requested for "+ozoneWrapper.getKeyForArrDivIds(o)+", will not call for ads."):overrideCallback?(ozoneLog(`prebid auction call timed out after ${e}ms - going to call the callback function **with the overrideCallback value**`),ozoneWrapper.setAdserverRequestSent(o,!0),n(overrideCallback)):n?(ozoneLog(`prebid auction call timed out after ${e}ms - going to call the callback function`),ozoneWrapper.setAdserverRequestSent(o,!0),n(configVars.callbackArg)):(ozoneLog(`prebid auction call timed out after ${e}ms - going to call sendAdServerRequest`),ozoneWrapper.sendAdserverRequest(o))},e)})},ozoneFetchBids:function(e,o){if(ozoneLog(`ozoneFetchBids was called. document.readyState is ${document.readyState} and optionalDivIds: `,e,"callback",o),"loading"===document.readyState)return!1;if(!configVars.allOk)return console.error("ozoneFetchBids was called, but there is a config error; check console.log for details."),!1;let n=[];2!==arguments.length&&configVars.getElapsedMs()>configVars.refresh.callAdserverUntilMs&&ozoneError("NOTE: googletag.pubads().refresh will be called after auction because there is no callback fn. OzoneFetchBids() generally expects 2 args. Did you forget to send a callback function?"),2!==arguments.length&&configVars.getElapsedMs()<=configVars.refresh.callAdserverUntilMs&&ozoneLog("NOTE: googletag.pubads().refresh will be called after auction because there is no callback fn and we are within the initial timing window"),Array.isArray(e)?n=e:"string"==typeof e?n=[e]:ozoneLog("ozoneFetchBids first arg was NOT an array OR a string we will ignore it: ",e),0===n.length&&ozoneLog("ozoneFetchBids will work on all adunits known to googletag"),ozoneWrapper.setAdserverRequestSent(n,!1),ozoneLog("pushing fn into ozoneWrapper.cmd to call processAdunitsWhichExist"),window.ozoneadunits.cmd.push(function(){window.ozoneplugin.cmd.push(function(){ozoneLog("*** adUnits & plugins have loaded so will call processAdunitsWhichExist now ***",n),ozoneWrapper.processAdunitsWhichExist(n,o)})})},ozoneFetchInstreamBid:function(e,o){return ozoneLog("ozoneFetchInstreamBid was called. adUnitCode: ",e,"callback",o),2!==arguments.length?(console.error("ozoneFetchInstreamBid was called with the wrong number of parameters (MUST be 2)"),!1):"string"!=typeof e?(console.error("ozoneFetchInstreamBid first param is the wrong type - should be a div ID (string)"),!1):(ozoneWrapper.setAdserverRequestSent([e],!1),void window.ozoneadunits.cmd.push(function(){window.ozoneplugin.cmd.push(function(){ozoneLog(`*** adUnits & plugins have loaded so will call processInstreamAdunit now for single Div ID : ${e} ***`),ozoneWrapper.processInstreamAdunit(e,o)})}))},targetingManager:{initialTargeting:{},getInitialTargetingForDivId:function(e){if(!this.initialTargeting.hasOwnProperty(e)){var o=ozoneWrapper.getGoogletagSlotsForDivIds([e]);if(o.length<1)return ozoneError(`getInitialTargetingForDivId FAILED to find googletag slot for div id ${e} - will return default {}`),{};o=o[0];this.initialTargeting[e]=o.getTargetingMap()}return this.initialTargeting[e]}},processAdunitsWhichExist:function(o,n){o=o||[],ozoneLog(n&&"function"==typeof n?"processAdunitsWhichExist Detected a callback function":"processAdunitsWhichExist got no callback function");let t=[];var r=googletag.pubads().getSlots();let s=[];ozoneLog("processAdunitsWhichExist getSlots found full list of googletag slots: ",JSON.parse(JSON.stringify(r)));for(let e=0;e<r.length;e++){var i=r[e],a=i.getSlotElementId();if(0<o.length&&-1===o.indexOf(a))ozoneLog("processAdunitsWhichExist SKIPPING div ID not requested in args: "+a);else{ozoneLog("processAdunitsWhichExist div ID requested in args: "+a);try{var l=pluginPushAdunitForGptAdSlot(t,i,this.targetingManager.getInitialTargetingForDivId(a),configVars);0<l?(ozoneLog(`pluginPushAdunitForGptAdSlot added ${l} adunits for divId: `+a),s.push(a)):ozoneLog("pluginPushAdunitForGptAdSlot did not add any adunits for divId: "+a)}catch(e){ozoneError(`pluginPushAdunitForGptAdSlot raised error for divId ${a}. Error = `+e)}}}t.length<1?(ozoneLog("processAdunitsWhichExist Found NO adunits to send to auction"),n?setTimeout(function(){n(configVars.callbackArg),ozoneLog("called the callback")},1):ozoneWrapper.getAdserverRequestSent(o)?ozoneLog("will not call sendAdserverRequest - its already been called"):(ozoneLog("going to call sendAdserverRequest"),ozoneWrapper.sendAdserverRequest(o))):(ozoneLog("processAdunitsWhichExist got list of adunits to send to auction",JSON.parse(JSON.stringify(t))),ozoneWrapper.getAdserverRequestSent(o)?ozoneLog("Ads have already been requested! We will not continue with the auction."):(ozoneLog("going to push the auction calling function into ozoneWrapper.cmd"),ozoneWrapper.cmd.push(function(){ozoneWrapper.startPrebidTimeout(configVars.PREBID_BACKSTOP_TIMEOUT,o,n),window.ozwrap_pbjs.que.push(function(){if(ozoneWrapper.getAdserverRequestSent(o))ozoneLog("Ads have already been requested! We will not call ozwrap_pbjs.requestBids");else{ozoneLog("going to call ozwrap_pbjs.requestBids"),ozwrap_pbjs.addAdUnits(t);let e={bidsBackHandler:function(){ozoneWrapper.getAdserverRequestSent(o)?ozoneLog("Bidsbackhandler will not call sendAdserverRequest - its already been called"):(ozoneLog("Bidsbackhandler going to call sendAdserverRequest"),ozoneWrapper.sendAdserverRequest(o))},adUnits:t,timeout:configVars.PREBID_TIMEOUT};n&&(e={bidsBackHandler:function(){ozoneLog("inside bidsbackhandler; about to call setTargetingForGPTAsync for ",o||"all"),ozwrap_pbjs.setTargetingForGPTAsync(s),ozoneWrapper.setCustomGptKeys(),ozoneLog("inside bidsbackhandler; about to call the callback fn for ",o||"all",n),n(configVars.callbackArg),ozoneWrapper.setAdserverRequestSent(o,!0),ozoneLog("inside bidsbackhandler; called the callback fn. Did not call pubads().refresh()")},adUnits:t,timeout:configVars.PREBID_TIMEOUT}),ozwrap_pbjs.requestBids(e)}})})))},processInstreamAdunit:function(o,n){let t=pluginGetInstreamAdUnit(o,configVars);t?ozoneWrapper.cmd.push(function(){ozoneWrapper.startPrebidTimeout(configVars.PREBID_BACKSTOP_TIMEOUT,[o],n,[]),window.ozwrap_pbjs.que.push(function(){var e;ozoneWrapper.getAdserverRequestSent([o])?ozoneLog("Ads have already been requested! We will not call ozwrap_pbjs.requestBids"):(ozoneLog("going to call ozwrap_pbjs.requestBids"),ozwrap_pbjs.addAdUnits([t]),e={bidsBackHandler:function(e){ozoneWrapper.setAdserverRequestSent([o],!0),n(e,t)},adUnits:[t],timeout:configVars.PREBID_TIMEOUT},ozwrap_pbjs.requestBids(e))})}):setTimeout(function(){n([])},1)},sendAdserverRequest:function(o){ozoneLog("In sendAdserverRequest : ozoneWrapper.getAdserverRequestSent = "+ozoneWrapper.getAdserverRequestSent(o)),ozoneWrapper.getAdserverRequestSent(o)&&ozoneLog("sendAdserverRequest Will not refresh ads - they have already been requested",o),ozoneWrapper.setAdserverRequestSent(o,!0),configVars.tooLateToCallRefresh()?ozoneLog("sendAdserverRequest - will not refresh - the config says we are too late for this"):(ozoneLog("sendAdserverRequest going to refresh ads",o),googletag.cmd.push(function(){window.ozwrap_pbjs.que.push(function(){ozoneLog("sendAdserverRequest going to call setTargetingForGPTAsync"),ozwrap_pbjs.setTargetingForGPTAsync(),ozoneWrapper.setCustomGptKeys();try{ozoneLog("sendAdserverRequest - going to call the stored refresh callback fn; this will refresh the correct set of adunits"),ozonePubads.getRefreshFnForDivIds(o)()}catch(e){ozoneLog("sendAdserverRequest Failed to find/execute a stored refresh request for optional divids; will just call googletag.refresh for: ",o),Array.isArray(o)&&0<o.length?(ozoneLog("sendAdserverRequest going to refresh list of adunit IDs: ",o),googletag.pubads().refresh(ozoneWrapper.getGoogletagSlotsForDivIds(o))):(ozoneLog("sendAdserverRequest going to refresh ALL adunits"),googletag.pubads().refresh())}ozoneLog("sendAdserverRequest - done calling the captured refresh fn")})}))},getGoogletagSlotsForDivIds:function(o){return ozoneLog("Going to filter googletag slots by list: ",o),googletag.pubads().getSlots().filter(e=>-1<o.indexOf(e.getSlotElementId()))},getDivIdsForSlots:function(o){var n=[];for(let e=0;e<o.length;e++)"object"==typeof o[e]&&o[e].hasOwnProperty("getSlotElementId")?n.push(o[e].getSlotElementId()):ozoneError("getDivIdsForSlots Skipping invalid item that *should* be a slot",o[e]);return n},slotRefresh:{slotCounters:{},getSlotCounterByDivId:function(e){for(var o of Object.keys(ozoneWrapper.slotRefresh.slotCounters))if(ozoneWrapper.slotRefresh.slotCounters[o].divId===e)return ozoneWrapper.slotRefresh.slotCounters[o];return ozoneError("slotRefresh getSlotCounterByDivId failed to find element by divId : "+e),null},getAdslotRefreshData:e=>{var o={type:"banner"};if(!configVars.slotRefresh)return null;var n=configVars.slotRefresh[e];if(!n)return null;let t=e;return ozoneWrapper.slotRefresh.isOutstreamAd(e)&&(t="ozone_video_ad_"+e,o.type="outstream"),o.divId=t,o.visibilityPercent=n.visibilityPercent,o.refreshSeconds=n.refreshSeconds,ozoneLog(`slotRefresh getAdslotRefreshData going to return ${JSON.stringify(o)} for slotElementId `+e),o},isOutstreamAd:function(e){return document.querySelector("#ozone_video_ad_"+e)},weNeedToMonitorDivId:function(e){return configVars.slotRefresh&&configVars.slotRefresh.hasOwnProperty(e)},init:function(e,o){var n,t;ozoneLog(`slotRefresh.init called for ${o} with data: `+JSON.stringify(e)),this.weNeedToMonitorDivId(o)&&e?(this.slotCounters[o]&&this.slotCounters[o].io&&(ozoneLog(`slotRefresh IntersectionObserver currently exists for ${o}, will disconnect & delete it`),this.slotCounters[o].io.disconnect(),delete ozoneWrapper.slotRefresh.slotCounters[o].io),ozoneLog(`slotRefresh.init; adding/refreshing slotElementId ${o} to slotCounters`),n=e.divId,t=e.visibilityPercent,this.slotCounters[o]={refreshAfterSeconds:e.refreshSeconds,divId:n,type:e.type,minVisibilityPc:t,currentSecondsVisible:0,becameVisible:null,elementId:o},ozoneLog("slotRefresh Adding new IntersectionObserver for "+o),this.slotCounters[o].io=ozoneWrapper.slotRefresh.setupInsersectionObserver(t),this.slotCounters[o].io.observe(document.getElementById(n))):ozoneLog(`slotRefresh.init called, with slotElementId ${o}; config does not say to monitor it in slotCounters; will not continue`)},slotVisibilityIsAboveThreshold:e=>{ozoneLog("slotRefresh slotVisibilityIsAboveThreshold elementId = "+e);e=ozoneWrapper.slotRefresh.slotCounters[e];null===e.becameVisible&&(e.becameVisible=Date.now())},slotVisibilityIsBelowThreshold:e=>{ozoneLog("slotRefresh slotVisibilityIsBelowThreshold elementId = "+e);var o,e=ozoneWrapper.slotRefresh.slotCounters[e];null!==e.becameVisible&&(o=Date.now()-e.becameVisible,e.currentSecondsVisible+=o/1e3,e.becameVisible=null)},checkForRefreshRequired:()=>{ozoneLog("slotRefresh checkForRefreshRequired Checking for any ads that need to be refreshed...");for(var o of Object.keys(ozoneWrapper.slotRefresh.slotCounters)){var n,t=ozoneWrapper.slotRefresh.slotCounters[o];if("banner"===t.type&&ozoneWrapper.slotRefresh.isOutstreamAd(o))return ozoneLog(`slotRefresh we've got the wrong ad type for elementid: ${o} - need to trash this & start it off again as an outstream ad`),void ozoneWrapper.slotRefresh.init(ozoneWrapper.slotRefresh.getAdslotRefreshData(o),o);let e=t.currentSecondsVisible;null!==t.becameVisible&&(n=Date.now()-t.becameVisible,e+=n/1e3),e>=t.refreshAfterSeconds&&(configVars.refresh.fetchBids&&!configVars.tooLateToCallRefresh()?(ozoneLog("slotRefresh checkForRefreshRequired - slot needs refreshing - we are currently listening for refresh; going to call googletag.pubads().refresh for slot "+o),googletag.pubads().refresh(ozoneWrapper.getGoogletagSlotsForDivIds([o]))):(ozoneLog("slotRefresh checkForRefreshRequired - slot needs refreshing - we are not listening for refresh; going to call ozoneFetchBids for slot "+o),ozoneFetchBids([o])),t.currentSecondsVisible=0,null!==t.becameVisible)&&(t.becameVisible=Date.now())}},startTimer:()=>{ozoneWrapper.slotRefresh.checkForRefreshRequired(),setTimeout(ozoneWrapper.slotRefresh.startTimer,1e3)},io_callback:function(e,o){e.forEach(e=>{var o,n=parseInt(100*e.intersectionRatio),e=e.target.getAttribute("id"),e=(ozoneLog(`slotRefresh io_callback: INTERSECTION entry. visible% = ${n} for div ID: `+e),ozoneWrapper.slotRefresh.getSlotCounterByDivId(e));e&&(o=e.minVisibilityPc,e=e.elementId,o<=n?ozoneWrapper.slotRefresh.slotVisibilityIsAboveThreshold(e):ozoneWrapper.slotRefresh.slotVisibilityIsBelowThreshold(e))})},setupInsersectionObserver:function(e){return new IntersectionObserver(ozoneWrapper.slotRefresh.io_callback,{root:null,rootMargin:"0px",threshold:e/100})}}});function ozoneFetchBids(e,o){return ozoneWrapper.ozoneFetchBids.apply(null,arguments)}function ozoneFetchInstreamBid(e,o){return ozoneWrapper.ozoneFetchInstreamBid.apply(null,arguments)}googletag.cmd.push(()=>{ozoneWrapper.slotRefresh.startTimer(),googletag.pubads().addEventListener("slotRenderEnded",function(e){e=e.slot.getSlotElementId();ozoneLog(`slotRefresh googletag slotRenderEnded listener: ${e} loaded`),ozoneWrapper.slotRefresh.init(ozoneWrapper.slotRefresh.getAdslotRefreshData(e),e)})}),ozoneLog("bottom of Ozone ozpb_core.js"),window.ozwrap_pbjs?ozoneLog("window.ozwrap_pbjs is found - OK!"):ozoneError("ERROR: window.ozwrap_pbjs is not found! This will not work!");