/* HouseHold ImplementationValidator LegacyLayer SignalsAbs SignalsAutoInsertion SignalsBsc SignalsIds SignalsTvp SignalsVlp */
(()=>{var Nt=Object.defineProperty,Ue=Object.defineProperties,Pe=Object.getOwnPropertyDescriptor,we=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var xe=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var qt=(n,t,e)=>t in n?Nt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,W=(n,t)=>{for(var e in t||(t={}))xe.call(t,e)&&qt(n,e,t[e]);if(re)for(var e of re(t))Ce.call(t,e)&&qt(n,e,t[e]);return n},ot=(n,t)=>Ue(n,we(t)),i=(n,t)=>Nt(n,"name",{value:t,configurable:!0});var s=(n,t,e,r)=>{for(var o=r>1?void 0:r?Pe(t,e):t,a=n.length-1,l;a>=0;a--)(l=n[a])&&(o=(r?l(t,e,o):l(o))||o);return r&&o&&Nt(t,e,o),o};var g=(n,t,e)=>(qt(n,typeof t!="symbol"?t+"":t,e),e);var y=(n,t,e)=>new Promise((r,o)=>{var a=f=>{try{p(e.next(f))}catch(T){o(T)}},l=f=>{try{p(e.throw(f))}catch(T){o(T)}},p=f=>f.done?r(f.value):Promise.resolve(f.value).then(a,l);p((e=e.apply(n,t)).next())});var d={"4817":{adServerId:1360,customTracking:{c1:{type:"targeting",key:"permutive"},c3:{type:"targeting",key:"rec_ord"},c4:{type:"targeting",key:"page_type"},c5:{type:"targeting",key:"hb_pb"},c6:{type:"targeting",key:"group"}},adPositionKey:"slot"}};var Lt={queueAdRequest:n=>{var t;try{(t=n.callback)==null||t.call(n),n.callback=null}catch(e){}},defineSlot:(n,t)=>{},getTargeting:n=>({}),addEventListener:(n,t)=>{},removeEventListener:(n,t)=>{},toggleDebugMode:()=>{console.log("%c[UT-DEBUG]%c Debug mode is not available for this tag.","color: red","color: intial")},onSlotVisibleForTime:(n,t,e)=>{}};var Mt=class Mt{constructor(){g(this,"isEntryModule",!0)}};i(Mt,"EntryModule");var E=Mt;var vt=class vt{constructor(t){g(this,"_error");g(this,"_message","unknown");g(this,"_trace",[]);if(t instanceof vt)return t;t instanceof Error&&(this._error=t,this._message=t.message)}get error(){return this._error}get message(){return this._message}get trace(){return this._trace}addToTrace(t){this.trace.unshift(t)}};i(vt,"TracedError");var nt=vt;var It=class It{constructor(t,e){g(this,"window");g(this,"dvtag");g(this,"modules",new Map);g(this,"errorHandlers",[]);g(this,"errors",[]);var r;this.window=e,this.window.dvtag=(r=this.window.dvtag)!=null?r:{},this.dvtag=this.window.dvtag,this.dvtag._core=this;for(let[o,a]of Object.entries(Lt))this.dvtag[o]=a;for(let o of t)this.createModule(o);for(let o of this.modules.values())this.applyModuleDecoration(o);for(let o of this.modules.values())this.applyErrorDecoration(o);for(let o of this.modules.values())this.applyPluginDecoration(o);for(let o of this.modules.values())this.applyApiDecoration(o);for(let o of this.modules.values())this.applyExecuteDecoration(o)}get moduleList(){return[...this.modules.keys()].map(t=>t.name)}get entryModuleList(){return[...this.modules.entries()].filter(([t,e])=>e instanceof E).map(([t,e])=>t.name)}get(t){return this.getModule(t).gateway}getByName(t){let e=[...this.modules.keys()].find(r=>r.name===t);return e!=null?this.get(e):null}getModule(t){let e=this.modules.get(t);if(e==null)throw new Error(`module not in core: ${t.name}`);return e}createModule(t){if(t.prototype.moduleConfig==null)throw new Error(`not a module: ${t.name}`);let e=new t;e.core=this,e.gateway={module:e},this.modules.set(t,e)}applyModuleDecoration(t){var o,a,l,p,f,T;let e=t.constructor.prototype.moduleConfig,r=t.constructor.name;for(let{method:_}of e){let H=t[_].bind(t),et=(l=(a=(o=this.dvtag._hooks)==null?void 0:o.interceptModule)==null?void 0:a[r])==null?void 0:l[_],w=et==null?H:et.bind(t),$=(T=(f=(p=this.dvtag._hooks)==null?void 0:p.inspectModule)==null?void 0:f[r])==null?void 0:T[_],kt=$==null?w:(...ut)=>{let rt=w(...ut);return $(ut,rt),rt},be=i((...ut)=>{let rt;try{rt=kt(...ut)}catch(ft){throw this.traceMethodError(t,_,ut,ft)}return rt instanceof Promise?rt.then(ft=>ft,ft=>{throw this.traceMethodError(t,_,ut,ft)}):rt},"traced");t.gateway[_]=be}if(t.plugins!=null){t.pluginFunctions={};for(let _ of Object.keys(t.plugins)){t.pluginFunctions[_]=[];let H=t.pluginFunctions[_];t.plugins[_]=(...et)=>{let w=[];for(let $ of H)try{w.push($(...et))}catch(kt){this.tracePluginError(t,_,kt)}return w}}}}traceMethodError(t,e,r,o){let a=new nt(o);return a.addToTrace(`${t.constructor.name}.${e}(${r.map(l=>typeof l).join(",")})`),a}traceExecuteError(t){let e=new nt(t);return e.addToTrace("@execute"),this.handleSevereError(e),e}tracePluginError(t,e,r){let o=new nt(r);return o.addToTrace(`@plugin(${t.constructor.name}, '${e}')`),this.handleSevereError(o),o}traceApiError(t,e){let r=new nt(e);return r.addToTrace(`@api('${t}')`),this.handleSevereError(r),r}handleSevereError(t){for(let e of this.errorHandlers)try{e(t)}catch(r){}this.errors.length>10||this.errors.push({message:t.message,trace:t.trace})}applyErrorDecoration(t){var r;let e=(r=t.constructor.prototype.errorConfig)!=null?r:[];for(let{method:o}of e)this.errorHandlers.push(t.gateway[o])}applyPluginDecoration(t){var r;let e=(r=t.constructor.prototype.pluginConfig)!=null?r:[];for(let{PluggableClass:o,category:a,method:l}of e)this.getModule(o).pluginFunctions[a].push(t.gateway[l])}applyApiDecoration(t){var r;let e=(r=t.constructor.prototype.apiConfig)!=null?r:[];for(let{api:o,method:a}of e)Object.defineProperty(this.dvtag,o,{value:(...l)=>{var p,f;try{return t.gateway[a](...l)}catch(T){return this.traceApiError(o,T),(f=(p=Lt)[o])==null?void 0:f.call(p,...l)}},writable:!1})}applyExecuteDecoration(t){return y(this,null,function*(){var r;let e=(r=t.constructor.prototype.executeConfig)!=null?r:[];for(let{method:o}of e)try{yield t.gateway[o]()}catch(a){this.traceExecuteError(a)}})}};i(It,"Core");var St=It;var Bt=[],Gt=Bt;var c=i(n=>{let t=n.prototype,e=Object.getOwnPropertyNames(t).filter(r=>{var o;return r!=="constructor"&&((o=Object.getOwnPropertyDescriptor(t,r))==null?void 0:o.value)instanceof Function});t.moduleConfig=e.map(r=>({method:r})),Bt.push(n)},"moduleClass"),I=i(n=>t=>{},"attachModule"),P=i((n,t)=>{var e;n.executeConfig=(e=n.executeConfig)!=null?e:[],n.executeConfig.push({method:t})},"executeMethod"),m=i((n,t)=>(e,r)=>{var o;e.pluginConfig=(o=e.pluginConfig)!=null?o:[],e.pluginConfig.push({PluggableClass:n,category:t,method:r})},"pluginMethod"),it=i(n=>(t,e)=>{var r;t.apiConfig=(r=t.apiConfig)!=null?r:[],t.apiConfig.push({api:n,method:e})},"apiMethod"),oe=i((n,t)=>{var e;n.errorConfig=(e=n.errorConfig)!=null?e:[],n.errorConfig.push({method:t})},"errorMethod");var ne=i(n=>{let t=n.split("/").map(o=>o.trim()).filter(o=>o.length>0);if(t.length<2)return null;let e=t[0].split(",",1)[0],r=Number(e);return Number.isNaN(r)?null:r},"getNetworkCodeFromAdUnit");var Ft="dvp_spos";var B=class{_getAdServers(){try{return d}catch(t){return{}}}isAdServerConfigured(t){return t in this._getAdServers()}getAdServerConfig(t){var e;return this.isAdServerConfigured(t)?(e=this._getAdServers()[t])!=null?e:{}:{}}getAdServerCustomTracking(t){var e;return this.isAdServerConfigured(t)?(e=this._getAdServers()[t].customTracking)!=null?e:{}:{}}getAdServerId(t){return this.isAdServerConfigured(t)?this._getAdServers()[t].adServerId:null}getAdPositionKeyForSlot(t){var r,o;let e=ne(t);return e==null?Ft:(o=(r=this._getAdServers()[e])==null?void 0:r.adPositionKey)!=null?o:Ft}};i(B,"AdServers"),B=s([c],B);var ct=i(n=>{if(n==null)return[];let t=ie(n);return t!=null?[t]:Array.isArray(n)?n.map(ie).filter(e=>e!=null):[]},"parseSlotSizes"),ie=i(n=>{if(n==null)return null;if(typeof n=="string")return{label:n};if(Array.isArray(n)){if(n.length===1&&typeof n[0]=="string")return{label:n[0]};if(n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number")return{width:n[0],height:n[1]}}if(typeof n=="object"){let{label:t,width:e,height:r}=n;if(typeof e=="number"&&typeof r=="number")return{width:e,height:r};if(typeof t=="string")return{label:t}}return null},"parseSlotSize");var se=i(n=>{try{return n.getSizes()}catch(t){return[]}},"getGptSlotSize");var Et=i((n,t)=>({id:n.getAdUnitPath(),sizes:ct(se(n)),position:n.getTargeting(t)[0]}),"gptSlotToAdUnit");var bt=i((n,t)=>({getTargeting:e=>[...new Set([...t(e),...n.getTargeting(e)])],setTargeting:(e,r)=>{n.setTargeting(e,r)}}),"gptSlotToTargetable");var Ut,Oe=new Uint8Array(16);function Kt(){if(!Ut&&(Ut=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ut))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ut(Oe)}i(Kt,"rng");var b=[];for(let n=0;n<256;++n)b.push((n+256).toString(16).slice(1));function ae(n,t=0){return b[n[t+0]]+b[n[t+1]]+b[n[t+2]]+b[n[t+3]]+"-"+b[n[t+4]]+b[n[t+5]]+"-"+b[n[t+6]]+b[n[t+7]]+"-"+b[n[t+8]]+b[n[t+9]]+"-"+b[n[t+10]]+b[n[t+11]]+b[n[t+12]]+b[n[t+13]]+b[n[t+14]]+b[n[t+15]]}i(ae,"unsafeStringify");var ke=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Qt={randomUUID:ke};function qe(n,t,e){if(Qt.randomUUID&&!t&&!n)return Qt.randomUUID();n=n||{};let r=n.random||(n.rng||Kt)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){e=e||0;for(let o=0;o<16;++o)t[e+o]=r[o];return t}return ae(r)}i(qe,"v4");var jt=qe;var pt=i(()=>jt(),"uuid");var zt=class zt{constructor(t,e,r,o,a){this._slotStore=t;this.source=e;this.elementId=r;this.adUnit=o;this._targetable=a;g(this,"uuid");g(this,"_variables",new Map);g(this,"_targeting",{});g(this,"_flushedTargeting",{});this.uuid=pt()}setVariable(t,e){this._variables.set(t,e)}getVariable(t){return this._variables.get(t)}clearVariable(t){this._variables.delete(t)}getUptTargetingKeys(){return[...new Set([...Object.keys(this._targeting),...this._slotStore.getUptPageTargetingKeys()])]}getUptTargetingForKey(t){var e;return[...new Set([...(e=this._targeting[t])!=null?e:[],...this._slotStore.getUptPageTargetingForKey(t)])]}getUptTargeting(){let t={};for(let e of this.getUptTargetingKeys())t[e]=this.getUptTargetingForKey(e);return t}setUptSlotTargeting(t){for(let[e,r]of Object.entries(t))this._targeting[e]=[...new Set(r)],this.flushUptTargetingToAdServer(e)}addUptSlotTargeting(t){var e;for(let[r,o]of Object.entries(t))this._targeting[r]=[...new Set([...(e=this._targeting[r])!=null?e:[],...o])],this.flushUptTargetingToAdServer(r)}getAdServerTargeting(t){var e,r;return(r=(e=this._targetable)==null?void 0:e.getTargeting(t))!=null?r:[]}flushUptTargetingToAdServer(t){var o;if(this._targetable==null)return;let e=(o=this._flushedTargeting[t])!=null?o:[],r=this.getUptTargetingForKey(t);(e.length!==r.length||r.sort().some((a,l)=>e[l]!==a))&&(this._targetable.setTargeting(t,this.getUptTargetingForKey(t)),this._flushedTargeting[t]=r)}forceFlushAllUptTargetingToAdServer(){this._targetable!=null&&(this._flushedTargeting={},this.getUptTargetingKeys().forEach(t=>this.flushUptTargetingToAdServer(t)))}validateAdServerTargeting(){let t=2;for(let e of this.getUptTargetingKeys()){let r=this.getUptTargetingForKey(e),o=this.getAdServerTargeting(e);if(r.length>o.length||r.some(a=>!o.includes(a)))return 0;o.length>r.length&&(t=1)}return t}};i(zt,"Slot");var Tt=zt;var S=class{constructor(){g(this,"plugins",{slotScanned:(t,e)=>[],slotDiscovered:t=>[],slotRequested:(t,e)=>[],slotDestroyed:t=>[]});g(this,"_slots",{});g(this,"_pageTargeting",{})}getSlot(t,e){var r;return(r=this._slots[t])==null?void 0:r[e]}getSlots(t){var e;if(t==null){let r=[];for(let o of Object.values(this._slots))r.push(...Object.values(o));return r}return Object.values((e=this._slots[t])!=null?e:{})}createSlot(t,e,r,o){var p,f;let a=this.getSlot(t,e);a!=null&&this.plugins.slotDestroyed(a);let l=new Tt(this,t,e,r,o);(f=(p=this._slots)[t])!=null||(p[t]={}),this._slots[t][e]=l;for(let T of Object.keys(this._pageTargeting))l.flushUptTargetingToAdServer(T);return this.plugins.slotDiscovered(l),l}notifySlotScanned(t,e){this.plugins.slotScanned(t,e)}notifyAdRequested(t,e){this.plugins.slotRequested(t,e)}getUptPageTargetingKeys(){return Object.keys(this._pageTargeting)}getUptPageTargetingForKey(t){var e;return(e=this._pageTargeting[t])!=null?e:[]}getUptPageTargeting(){let t={};for(let[e,r]of Object.entries(this._pageTargeting))t[e]=[...r];return t}setUptPageTargeting(t){for(let[e,r]of Object.entries(t))this._pageTargeting[e]=[...new Set(r)];this._flushUptPageTargetingToAdServer(Object.keys(t))}addUptPageTargeting(t){var e;for(let[r,o]of Object.entries(t))this._pageTargeting[r]=[...new Set([...(e=this._pageTargeting[r])!=null?e:[],...o])];this._flushUptPageTargetingToAdServer(Object.keys(t))}_flushUptPageTargetingToAdServer(t){for(let e of Object.values(this._slots))for(let r of Object.values(e))for(let o of t)r==null||r.flushUptTargetingToAdServer(o)}};i(S,"SlotStore"),S=s([c],S);var Vt=class Vt{constructor(){g(this,"pending",[]);g(this,"flushing",!1)}push(t){this.pending.push(t),this.flush()}flush(){return y(this,null,function*(){var e;if(this.flushing)return;this.flushing=!0;let t=this.pending.shift();for(;t!=null;){try{yield t.promise}catch(r){}try{(e=t.callback)==null||e.call(t)}catch(r){}t=this.pending.shift()}this.flushing=!1})}};i(Vt,"AsyncQueue");var Pt=Vt;var A=class{constructor(){g(this,"plugins",{adRequestQueued:t=>[],adRequestTimedOut:t=>[],adRequestBeforeRelease:t=>[],adRequestCompleted:t=>[]});g(this,"queue",new Pt);g(this,"adRequestCounter",0)}_queueAdRequest(t={}){var a,l;let e={index:this.adRequestCounter++,status:"queued",timeoutValue:(a=t.timeout)!=null?a:0,onDvtagReadyCalled:(l=t.timestamp)!=null?l:0,waitingStarted:new Date().getTime(),internal:t.internal};this.plugins.adRequestQueued(e);let r=t.callback;r===void 0?e.status="no-callback":r===null?e.status="tag-timeout":t.callback=()=>{e.status="queue-timeout",e.callbackCalled=new Date().getTime(),t.callback=null,this.plugins.adRequestTimedOut(e);try{r()}catch(p){}};let o=i(()=>{if(t.callback!=null){t.callback=null,e.status="success",e.callbackCalled=new Date().getTime(),this.plugins.adRequestBeforeRelease(e);try{r==null||r()}catch(p){}}else this.plugins.adRequestBeforeRelease(e);e.waitingEnded=new Date().getTime(),this.plugins.adRequestCompleted(e)},"onAsyncOperationsCompleted");this.queue.push({callback:o})}delayAdRequests(t){this.queue.push({promise:t})}};i(A,"AdRequestQueue"),s([it("queueAdRequest")],A.prototype,"_queueAdRequest",1),A=s([c],A);var Ne=[[/((\?)|&)(?:amp_lite|fr=operanews)/g,"$2"],[/(^https?:\/\/)(www\.)/g,"$1"],[/(((\?)|&|%3F|%26|;)(?:utm_campaign|utm_source|utm_content|utm_term|utm_viral|utm_medium|utm_identifier|utm_key|fb_source|referrer|referer|ref|rand|rnd|randid|\.?rand|\.?partner|cb|count|adid|session|sessionid|session_redirect|param\d|userinfo|uid|refresh|ocid|ncid|clickenc|fbclid|amp_js_v|amp_gsa|ns_source|ns_campaign|ns_mchanel|ns_mchannel|ns_linkname|ns_fee|src|ex_cid|usqp|source|xid|trkid|utm_social-type|mbid|utm_brand|__twitter_impression|utm_referrer|CMP|cmp|_cmp|cq_cmp)=[^&]*)/g,"$3"],[/[/.]amp(?:\/[?&]*)?$/g,""],[/((\?)|&)(?:outputType|isFollow|suppressMediaBar|cid|ICID|icid|bdk|wtu_id_h|utm_placement|intcmp|_native_ads|traffic_source|entry|\.tsrc|autoplay|autostart|dc_data|influencer|pubdate|utm_hp_ref|redirect|service|refresh_ce|refresh_cens|xcmg|target_id|_amp)=[^&]*/g,"$2"],[/(\?|&)(?:amp)(?:&|$|=[^&]*)/g,"$1"]],Le=[[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""],[/(?:\/|\/\?|\?|&|\/\$0|#[\s\S]*)+$/g,""]],ge=i((n,t)=>{for(let[e,r]of n)t=t.replace(e,r);return t},"replaceByRules"),le=i(n=>{let t=ge(Ne,n);return ge(Le,t)},"normalizeUrl");var de=i(n=>n.split("?",1)[0].split("#",1)[0],"stripUrlQuery");var ue=i((n,t)=>{try{let e=new URLSearchParams(n),r=e.get("ctx"),o=e.get("cmp");if(r!=null&&o!=null)return{ctx:r,cmp:o,prefetch:t,legacy:!0}}catch(e){}return null},"parseInfo"),ce=i(n=>{var t;return n.pathname!=="/signals/pub.js"?null:(t=ue(n.search,!0))!=null?t:ue(n.hash.substring(1),!1)},"parseLegacyPagetagUrl");var Me=/^\/dvtag\/([^/]+)\/([^/]+)\/pub\.js$/,U=class{constructor(){g(this,"visitUuid",pt());g(this,"tagInfo");g(this,"normalizedUrl")}_initialize(){this.getTagInfo()}getTagInfo(){var t;if(this.tagInfo==null){try{this.tagInfo=this._parseTagInfo()}catch(e){}(t=this.tagInfo)!=null||(this.tagInfo={ctx:"unknown",cmp:"unknown"})}return this.tagInfo}getVisitUuid(){return this.visitUuid}_parseTagInfo(){let t=this.getCurrentScriptSrc();if(t==null)return null;let e=new URL(t,"https://pub.doubleverify.com"),r=e.pathname,o=Me.exec(r);if(o!=null){let[,a,l]=o;return{ctx:a,cmp:l}}return ce(e)}getCurrentScriptSrc(){var t,e;return(e=(t=this.core.window.document.currentScript)==null?void 0:t.getAttribute("src"))!=null?e:null}getStrippedPageUrl(){return de(this.core.window.location.href)}getNormalizedPageUrl(){var e;let t=this.getStrippedPageUrl();return((e=this.normalizedUrl)==null?void 0:e.stripped)!==t&&(this.normalizedUrl={stripped:t,normalized:le(this.core.window.location.href)}),this.normalizedUrl.normalized}};i(U,"Context"),s([P],U.prototype,"_initialize",1),U=s([c],U);var G=class{getShortCommitId(){return"da546d1"}getBuildTimestamp(){return 1725044426853}getAuthToken(){return"8iS8/bIA9EK/7eBuDCGUu3gbwVHqNr4o5BeeulOrVYy4pgo8H/KsCf1Q9CndfnruluS97dDWuuJSdVS5p6Gkv3NKuY/henDpPe39rc/5hHRFG2vfPL5n7JL8YZ5bxhOgpQLz7SQ5XMT9qZsNJ4iCR+wEdijmves="}};i(G,"DefinedVariables"),G=s([c],G);var O=class{constructor(){g(this,"cache",{})}_performFetchJson(t,e){return y(this,null,function*(){let r=t;if(e!=null&&e.authToken){let l=this.core.get(G).getAuthToken(),p=new URL(t);p.searchParams.set("token",l),r=p.href}let o=yield this.core.window.fetch(r);return{json:yield o.json(),headers:o.headers}})}fetchJson(t,e){return y(this,null,function*(){let r=this.cache[t];return r==null&&(r=this._performFetchJson(t,e).then(o=>o.json),this.cache[t]=r),r})}};i(O,"Fetch"),O=s([c],O);var yt=["BSC","ABS","CCT"],Yt=["IDS"],Rt=["VLP","TVP"],Ie=[...yt,...Yt,...Rt],Yn=[...yt,...Yt,...Rt].filter(n=>n!=="CCT"),pe=i(n=>Ie.includes(n.toUpperCase()),"isSignal"),me=i(n=>Rt.includes(n.toUpperCase()),"isSlotSignal"),he=i(n=>Yt.includes(n.toUpperCase()),"isUserSignal"),fe=i(n=>yt.includes(n.toUpperCase()),"isPageSignal");var wt=i(n=>n==null?"":`@${n}`,"getPositionSuffix");var Be=/^(\d+)x(\d+)$/,Se=i(n=>n==="all"?[]:n.split(",").map(t=>{let e=t.match(Be);return e==null?{label:t}:{width:parseInt(e[1],10),height:parseInt(e[2],10)}}),"stringToSlotSizes"),Ht=i(n=>n.length===0?"all":n.map(({width:t,height:e,label:r})=>r!=null?r:`${t}x${e}`).join(","),"slotSizesToString"),Te=i(n=>n==null?"":n.length>0&&n.every(({label:r})=>r==null)?Ht(n):"","slotSizesToStringIfSpecific");var Ge="https://pub.doubleverify.com/dvtag/signals/",k=class{_getBaseUrl(t){let e=this.core.get(U),{ctx:r,cmp:o}=e.getTagInfo(),a=e.getNormalizedPageUrl();try{a=new URL(a).origin}catch(p){}let l=new URL(t,Ge);return l.searchParams.set("ctx",r),l.searchParams.set("cmp",o),l.searchParams.set("url",a),l}getUserTargetingUrl(t){let e=this._getBaseUrl("ids/pub.json");return t.includes("IDS")&&e.searchParams.set("ids","1"),e.href}getPageTargetingUrl(t,e){let r=this._getBaseUrl("bsc/pub.json");return r.searchParams.set("url",e),t.includes("BSC")&&r.searchParams.set("bsc","1"),t.includes("ABS")&&r.searchParams.set("abs","1"),t.includes("CCT")&&r.searchParams.set("cct","1"),r.href}getSlotTargetingUrl(t,e){var a;let r=this._getBaseUrl("vlp/pub.json");t.includes("VLP")&&r.searchParams.set("vlp","1"),t.includes("TVP")&&r.searchParams.set("tvp","1");let o=0;for(let l of e){let{id:p,position:f,sizes:T}=(a=l.adUnit)!=null?a:{},_=p+wt(f);r.searchParams.set(`slot-${o++}-${_}`,Te(T))}return r.href}};i(k,"SignalsUrlBuilder"),k=s([c],k);var X=class{constructor(){g(this,"cache",{})}_fetchFreshSignals(t,e){return y(this,null,function*(){if(!e.some(fe))return{};let r=this.core.get(k).getPageTargetingUrl(e,t),o;try{o=yield this.core.get(O).fetchJson(r,{authToken:!0})}catch(a){return{}}return o instanceof Object?o:{}})}fetchSignals(t,e=3){return y(this,null,function*(){let r=this.core.get(U),o=r.getNormalizedPageUrl(),a=r.getStrippedPageUrl();this.cache[a]==null&&(this.cache[a]=this._fetchFreshSignals(o,t));let l=yield this.cache[a];return this.core.get(U).getStrippedPageUrl()!==a&&e>0?this.fetchSignals(t,e-1):l})}};i(X,"PageSignals"),X=s([c],X);var J=class{constructor(){g(this,"cache",{});g(this,"pendingSlots",[]);g(this,"pendingBulkRequest",null)}_scheduleBulkRequest(t){return y(this,null,function*(){yield Promise.resolve();let e=this.core.get(k).getSlotTargetingUrl(t,this.pendingSlots);this.pendingSlots=[],this.pendingBulkRequest=null;let r;try{r=yield this.core.get(O).fetchJson(e,{authToken:!0})}catch(o){return[]}return r})}_fetchFreshSignals(t,e){return y(this,null,function*(){if(!e.some(me))return{};let r=this.pendingSlots.push(t)-1;this.pendingBulkRequest==null&&(this.pendingBulkRequest=this._scheduleBulkRequest(e));let a=(yield this.pendingBulkRequest)[r];return a instanceof Object?a:{}})}_getCacheKey(t){var p,f;let{id:e,position:r,sizes:o}=(p=t.adUnit)!=null?p:{},a=e+wt(r),l=(f=o==null?void 0:o.map(T=>{var _;return(_=T.label)!=null?_:`${T.width}x${T.height}`}).sort().join(","))!=null?f:"";return`${a}#${l}`}fetchSignals(t,e){return y(this,null,function*(){let r=this._getCacheKey(t);return this.cache[r]==null&&(this.cache[r]=this._fetchFreshSignals(t,e)),this.cache[r]})}};i(J,"SlotSignals"),J=s([c],J);var Z=class{constructor(){g(this,"cache")}_fetchFreshSignals(t){return y(this,null,function*(){if(!t.some(he))return{};let e=this.core.get(k).getUserTargetingUrl(t),r;try{r=yield this.core.get(O).fetchJson(e,{authToken:!0})}catch(o){return{}}return r instanceof Object?r:{}})}fetchSignals(t){return y(this,null,function*(){return this.cache==null&&(this.cache=this._fetchFreshSignals(t)),this.cache})}};i(Z,"UserSignals"),Z=s([c],Z);var R=class{constructor(){g(this,"plugins",{getEnabledSignals:()=>[],userTargetingUpdated:t=>[],pageTargetingUpdated:t=>[],slotTargetingUpdated:(t,e)=>[]});g(this,"dataForMigrationTracking",{userTargeting:{},pageTargeting:{},slotTargeting:new Map})}getEnabledSignals(){return this.plugins.getEnabledSignals()}getDataForMigrationTracking(){return this.dataForMigrationTracking}_initialize(){this.getUserTargeting(),this.getPageTargeting()}_onAdRequestQueued(){this.getPageTargeting()}_onSlotDiscovered(t){this.getSlotTargeting(t)}getUserTargeting(){return y(this,null,function*(){let t=this._fetchUserTargeting();return this.core.get(A).delayAdRequests(t),t})}getPageTargeting(){return y(this,null,function*(){let t=this._fetchPageTargeting();return this.core.get(A).delayAdRequests(t),t})}getSlotTargeting(t){return y(this,null,function*(){let e=this._fetchSlotTargeting(t);return this.core.get(A).delayAdRequests(e),e})}_fetchUserTargeting(){return y(this,null,function*(){let t=this.core.get(S),e=yield this.core.get(Z).fetchSignals(this.getEnabledSignals());return t.setUptPageTargeting(e),this.dataForMigrationTracking.userTargeting=e,this.plugins.userTargetingUpdated(e),e})}_fetchPageTargeting(){return y(this,null,function*(){let t=this.core.get(S),e=yield this.core.get(X).fetchSignals(this.getEnabledSignals());return t.setUptPageTargeting(e),this.dataForMigrationTracking.pageTargeting=e,this.plugins.pageTargetingUpdated(e),e})}_fetchSlotTargeting(t){return y(this,null,function*(){let e=yield this.core.get(J).fetchSignals(t,this.getEnabledSignals());return t.setUptSlotTargeting(e),this.dataForMigrationTracking.slotTargeting.set(t,e),this.plugins.slotTargetingUpdated(t,e),e})}};i(R,"Signals"),s([P],R.prototype,"_initialize",1),s([m(A,"adRequestQueued")],R.prototype,"_onAdRequestQueued",1),s([m(S,"slotDiscovered")],R.prototype,"_onSlotDiscovered",1),R=s([c],R);var q=class{constructor(){g(this,"pq",null)}getPq(){return this.pq==null&&(this.pq=this._initialize()),this.pq}getPts(){return this.getPq().PTS}setApi(t){let e=this.getPq();e!=null&&(e.init=()=>{},e.loadSignals=t.loadSignals,e.loadSignalsForSlots=t.loadSignalsForSlots,e.getTargeting=t.getTargeting)}_pushToDvtagCmd(...t){var e;this.core.dvtag.cmd=(e=this.core.dvtag.cmd)!=null?e:[],this.core.dvtag.cmd.push(...t)}_initialize(){var r,o;this.core.window.PQ=(r=this.core.window.PQ)!=null?r:{};let t=this.core.window.PQ;if(t.loaded)return{cmd:[],PTS:{}};t.loaded=!0,t.PTS=(o=t.PTS)!=null?o:{};let e=t.cmd;return t.cmd={push:a=>this._pushToDvtagCmd(a)},Array.isArray(e)&&this._pushToDvtagCmd(...e),t}};i(q,"LegacyPq"),q=s([c],q);var ye=i(n=>{var r,o,a;let t=pt(),e={id:(o=(r=n.adUnitPath)!=null?r:n.invCode)!=null?o:n.tagId,sizes:ct(Se((a=n.sizes)!=null?a:"all")),position:n.position};return{elementId:t,adUnit:e}},"parseLegacyAdUnit");var Re=i((n,t)=>{var o;let e=(o=n.IDS)==null?void 0:o[0];if(e==null)return;let r=parseInt(e);isNaN(r)||(t.IDS=r)},"setUserTargetingOnPts"),Ae=i((n,t)=>{for(let e of yt)n[e]!=null&&(t[e]=n[e])},"setPageTargetingOnPts"),_e=i((n,t,e)=>{var p,f,T,_,H,et;let{adUnit:r}=n;if((r==null?void 0:r.id)==null)return;let o=r.id,a=Ht((p=r.sizes)!=null?p:[]),l=r.position;for(let w of Rt){let $=t[w];$!=null&&((f=e[w])!=null||(e[w]={}),(_=(T=e[w])[o])!=null||(T[o]={}),e[w][o][a]=$[0],l!=null&&((et=(H=e[w][o])[l])!=null||(H[l]={}),e[w][o][l][a]=$[0]))}},"setSlotTargetingOnPts");var Fe="legacy-api",ve="gpt",F=class extends E{_initialize(){this.core.get(q).setApi({loadSignals:this.loadSignals.bind(this),loadSignalsForSlots:this.loadSignalsForSlots.bind(this),getTargeting:this.getTargeting.bind(this)})}_setUserTargetingOnPts(t){let e=this.core.get(q).getPts();Re(t,e)}_setPageTargetingOnPts(t){let e=this.core.get(q).getPts();Ae(t,e)}_setSlotTargetingOnPts(t,e){let r=this.core.get(q).getPts();_e(t,e,r)}loadSignals(t,e){return y(this,null,function*(){yield this._onDvtagReady("loadSignals",e)})}loadSignalsForSlots(t,e,r){return y(this,null,function*(){let o=this.core.get(R),a=this.core.get(S);for(let p of t){let f=p.getSlotElementId(),T=a.getSlot(ve,f);if(T==null){let _=this.core.get(B).getAdPositionKeyForSlot(p.getAdUnitPath());T=a.createSlot(ve,f,Et(p,_),bt(p,H=>this._getPubAdsTargeting(H)))}o.getSlotTargeting(T)}let l=typeof e=="function"?e:r;yield this._onDvtagReady("loadSignalsForSlots",l)})}getTargeting(t,e){return y(this,null,function*(){var l;let r=this.core.get(R),o=this.core.get(S);for(let p of(l=t.adUnits)!=null?l:[]){let{elementId:f,adUnit:T}=ye(p),_=o.createSlot(Fe,f,T);r.getSlotTargeting(_)}let a=i(()=>e==null?void 0:e(void 0,this.core.get(q).getPts()),"callback");yield this._onDvtagReady("getTargeting",a)})}_getPubAdsTargeting(t){var e,r,o;return(o=(r=(e=this.core.window.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e).getTargeting(t))!=null?o:[]}_onDvtagReady(t,e){return y(this,null,function*(){yield new Promise(r=>{this.core.window.dvtag.queueAdRequest({callback:()=>{try{e==null||e()}catch(o){}r()},timestamp:new Date().getTime(),timeout:750,internal:!0})})})}};i(F,"LegacyLayer"),s([P],F.prototype,"_initialize",1),s([m(R,"userTargetingUpdated")],F.prototype,"_setUserTargetingOnPts",1),s([m(R,"pageTargetingUpdated")],F.prototype,"_setPageTargetingOnPts",1),s([m(R,"slotTargetingUpdated")],F.prototype,"_setSlotTargetingOnPts",1),F=s([c],F);var st=class extends E{_getEnabledSignals(){return"IDS"}};i(st,"SignalsIds"),s([m(R,"getEnabledSignals")],st.prototype,"_getEnabledSignals",1),st=s([c],st);var at=class extends E{_getEnabledSignals(){return"BSC"}};i(at,"SignalsBsc"),s([m(R,"getEnabledSignals")],at.prototype,"_getEnabledSignals",1),at=s([c],at);var gt=class extends E{_getEnabledSignals(){return"VLP"}};i(gt,"SignalsVlp"),s([m(R,"getEnabledSignals")],gt.prototype,"_getEnabledSignals",1),gt=s([c],gt);var lt=class extends E{_getEnabledSignals(){return"TVP"}};i(lt,"SignalsTvp"),s([m(R,"getEnabledSignals")],lt.prototype,"_getEnabledSignals",1),lt=s([c],lt);var dt=class extends E{_getEnabledSignals(){return"ABS"}};i(dt,"SignalsAbs"),s([m(R,"getEnabledSignals")],dt.prototype,"_getEnabledSignals",1),dt=s([c],dt);var $t=class $t{set(t,e){t.setVariable(this,e)}get(t){return t.getVariable(this)}delete(t){t.clearVariable(this)}};i($t,"SlotVariable");var K=$t;var Wt=i((n,t)=>{var o,a,l,p;let e=n;e.googletag=(o=e.googletag)!=null?o:{},e.googletag.cmd=(a=e.googletag.cmd)!=null?a:[];let r=(p=(l=e.googletag).pubads)==null?void 0:p.call(l);r!=null?t(r):e.googletag.cmd.push(()=>{t(e.googletag.pubads())})},"onPubAdsReady");var xt="gpt",Ke=["impressionViewable","slotOnload","slotVisibilityChanged","rewardedSlotGranted","rewardedSlotClosed","rewardedSlotReady","slotRequested","slotRenderEnded","slotResponseReceived"],x=class{constructor(){g(this,"plugins",{googletagSlotDiscovered:()=>[],googletagSlotDestroyed:()=>[],slotRequested:()=>[],slotRenderEnded:()=>[],impressionViewable:()=>[],slotOnload:()=>[],slotVisibilityChanged:()=>[],slotResponseReceived:()=>[],rewardedSlotGranted:()=>[],rewardedSlotClosed:()=>[],rewardedSlotReady:()=>[]});g(this,"gptSlotReferences",new K);g(this,"initialized",!1)}_initialize(){this.initialized||(this.initialized=!0,Wt(this.core.window,t=>{this._addEventListeners(t),this._scanForSlots(t)}))}_onAdRequestQueued(t){Wt(this.core.window,e=>{this._scanForSlots(e,t)})}_onSlotDiscovered(t){t.source===xt&&this.plugins.googletagSlotDiscovered(t)}_onSlotDestroyed(t){t.source===xt&&this.plugins.googletagSlotDestroyed(t)}_onSlotRequested(t,e,r){this.core.get(S).notifyAdRequested(t,r)}_addEventListeners(t){Ke.forEach(e=>{t.addEventListener(e,r=>{let{slot:o,isNewlyDetected:a}=this._maybeDiscoverSlot(r.slot);o!=null&&this.plugins[e](o,r,a)})})}_scanForSlots(t,e){return t.getSlots().map(r=>this._maybeDiscoverSlot(r,e))}_maybeDiscoverSlot(t,e){let r=this.core.get(S),o=!1,a=t.getSlotElementId(),l=r.getSlot(xt,a),p=l!=null?this.gptSlotReferences.get(l):null,f=p!=null&&p!==t;if(l==null||f){let T=this.core.get(B).getAdPositionKeyForSlot(t.getAdUnitPath());l=r.createSlot(xt,a,Et(t,T),bt(t,_=>this._getPubAdsTargeting(_))),this.gptSlotReferences.set(l,t),o=!0}return r.notifySlotScanned(l,e),{slot:l,isNewlyDetected:o}}_getPubAdsTargeting(t){var e,r,o;return(o=(r=(e=this.core.window.googletag)==null?void 0:e.pubads)==null?void 0:r.call(e).getTargeting(t))!=null?o:[]}};i(x,"Googletag"),s([P],x.prototype,"_initialize",1),s([m(A,"adRequestQueued")],x.prototype,"_onAdRequestQueued",1),s([m(S,"slotDiscovered")],x.prototype,"_onSlotDiscovered",1),s([m(S,"slotDestroyed")],x.prototype,"_onSlotDestroyed",1),s([m(x,"slotRequested")],x.prototype,"_onSlotRequested",1),x=s([c],x);var Xt="qt_loaded",Ct="pts_pid",Ee="pts_sid";var Jt=i(n=>[...new Set(n.filter(pe).map(t=>t.toLowerCase()))],"getGreenlightSignal");var Q=class extends E{_autoInsertPageId(){let t=this.core.get(U);this.core.get(S).setUptPageTargeting({[Ct]:[t.getVisitUuid()]})}_autoInsertSlotId(t){t.setUptSlotTargeting({[Ee]:[t.uuid]})}_autoInsertGlobalTargeting(t){this.core.get(S).addUptPageTargeting({[Xt]:Jt(Object.keys(t))})}_autoInsertSlotTargeting(t,e){t.addUptSlotTargeting({[Xt]:Jt(Object.keys(e))})}};i(Q,"SignalsAutoInsertion"),s([P],Q.prototype,"_autoInsertPageId",1),s([m(S,"slotDiscovered")],Q.prototype,"_autoInsertSlotId",1),s([m(R,"userTargetingUpdated"),m(R,"pageTargetingUpdated")],Q.prototype,"_autoInsertGlobalTargeting",1),s([m(R,"slotTargetingUpdated")],Q.prototype,"_autoInsertSlotTargeting",1),Q=s([c,I(x)],Q);var C={TYPE:"b1",COMMIT_HASH:"b2",ENTRY_MODULES:"b3",HOSTNAME:"b4",CTX:"b5",CMP:"b6",VISIT_ID:"b7",FEATURE_FLAGS:"b8",TAG_FORMAT:"b9",SAMPLE_INTERVAL:"d1",FLUSH_TO_PXSRV:"d2",_PLACEHOLDER_BLOB_10:"b10",_PLACEHOLDER_DOUBLE_3:"d3",_PLACEHOLDER_DOUBLE_4:"d4",_PLACEHOLDER_DOUBLE_5:"d5"},Dt=ot(W({},C),{LOG_LEVEL:"b11",MESSAGE:"b12",TRACE:"b13"}),At=ot(W({},C),{AD_REQUEST_STATUS:"b11",AD_REQUEST_INDEX:"d6",AD_REQUEST_DELAY:"d7",INTEGRATION_STYLE:"b12"});var tt=class{getWindow(){return this.core.window}getDocument(){return this.getWindow().document}getUserAgent(){var t,e;return(e=(t=this.getWindow().navigator)==null?void 0:t.userAgent)!=null?e:""}getPageUrl(){var t,e;return(e=(t=this.getWindow().location)==null?void 0:t.href)!=null?e:""}getHostname(){return new URL(this.getPageUrl()).hostname}getNavigator(){return this.getWindow().navigator}getPerformance(){var t;return(t=this.getWindow().performance)!=null?t:{}}getPerformanceTimeMs(){var t,e,r;return Math.floor((r=(e=(t=this.getPerformance()).now)==null?void 0:e.call(t))!=null?r:null)}};i(tt,"Environment"),tt=s([c],tt);var Qe="https://pub.doubleverify.com/dvtag/metrics/event.png",je=1,ze=1,N=class{constructor(){g(this,"sharedDataPoints");g(this,"sampleInterval",ze)}_onAdRequestCompleted(t){if(t.index!==0)return;let{timeoutValue:e,onDvtagReadyCalled:r,callbackCalled:o}=t,a=o!=null?o-r:e;this.fireEvent("ad-request",{[At.AD_REQUEST_STATUS]:t.status,[At.AD_REQUEST_INDEX]:t.index,[At.AD_REQUEST_DELAY]:a,[At.INTEGRATION_STYLE]:t.internal?"legacy":"modern"},{sampleInterval:this.sampleInterval,flushToPxsrv:1})}_handleError(t){this.fireEvent("log",{[Dt.LOG_LEVEL]:"error",[Dt.MESSAGE]:t.message,[Dt.TRACE]:t.trace.join("=>")},{sampleInterval:je,flushToPxsrv:0})}_getSharedDataPoints(){if(this.sharedDataPoints==null){let t=this.core.get(U),e=this.core.get(G),r=this.core.get(tt),{ctx:o,cmp:a,legacy:l}=t.getTagInfo(),p=r.getHostname(),f=t.getVisitUuid(),T=e.getShortCommitId();this.sharedDataPoints={[C.COMMIT_HASH]:T,[C.ENTRY_MODULES]:"",[C.VISIT_ID]:f,[C.TAG_FORMAT]:l?"legacy":"modern",[C.FEATURE_FLAGS]:"",[C.CTX]:o,[C.CMP]:a,[C.HOSTNAME]:p}}return this.sharedDataPoints}fireEvent(t,e,{sampleInterval:r=1,flushToPxsrv:o=0}={}){if(Math.random()>=1/r)return;e=ot(W(W({},e),this._getSharedDataPoints()),{[C.TYPE]:t,[C.SAMPLE_INTERVAL]:r,[C.FLUSH_TO_PXSRV]:o});let a=new URL(Qe);for(let[l,p]of Object.entries(e)){let f=typeof p=="number"?Math.round(p):p;a.searchParams.set(l,f.toString())}this._sendBeacon(a.href)}_sendBeacon(t){try{typeof(navigator==null?void 0:navigator.sendBeacon)=="function"?navigator.sendBeacon(t):new Image().src=t}catch(e){}}};i(N,"Events"),s([m(A,"adRequestCompleted")],N.prototype,"_onAdRequestCompleted",1),s([oe],N.prototype,"_handleError",1),N=s([c],N);var Ve=Ct,M=class{constructor(){g(this,"restoreCount",0)}getRestoreCount(){return this.restoreCount}_restoreTargeting(){for(let t of this.core.get(S).getSlots())t.getAdServerTargeting(Ve).length===0&&(t.forceFlushAllUptTargetingToAdServer(),this.restoreCount+=1)}};i(M,"TargetingRestorer"),s([m(A,"adRequestQueued")],M.prototype,"_restoreTargeting",1),M=s([c],M);var Zt=class Zt{constructor(){g(this,"total",0);g(this,"dataPoints",0)}push(t){return this.total+=t,this.dataPoints+=1,this}get(){return this.total/this.dataPoints}getRounded(){return Math.round(this.get())}};i(Zt,"Average");var _t=Zt;var j=i(()=>{var n,t,e;return Math.floor((e=(t=(n=window.performance)==null?void 0:n.now)==null?void 0:t.call(n))!=null?e:Date.now())},"perfNowOrDateNow");var Ot=(l=>(l.UNKNOWN="UNKNOWN",l.SEEN="SEEN",l.NOT_READY="NOT_READY",l.POSSIBLE_TIMEOUT="POSSIBLE_TIMEOUT",l.PREV_READY="PREV_READY",l.READY="READY",l))(Ot||{});var Ye=5e3,te="dv_upt_slot_ready",He=["https://securepubads.g.doubleclick.net/gampad/ads?","https://pagead2.googlesyndication.com/gampad/ads?"],D=class{constructor(){g(this,"plugins",{onSlotRequested:()=>[],onSlotRequestValidated:()=>[]});g(this,"validateAdRequests",!1);g(this,"state",{firstSeen:new K,wasReady:new K,ready:new K,triggered:new K,lastTimeout:new K})}_onSlotScanned(t,e){var r;e!=null&&this.state.firstSeen.set(t,(r=this.state.firstSeen.get(t))!=null?r:e.index)}_onAdRequestCompleted(t){this._forEachSlotScannedByAdRequest(t,e=>{this.state.wasReady.set(e,!0),this.state.ready.set(e,j()),this.state.triggered.set(e,!1),this.validateAdRequests&&e.setUptSlotTargeting({[te]:["1"]})})}_onAdRequestTimedOut(t){let e=j();this._forEachSlotScannedByAdRequest(t,r=>{this.state.lastTimeout.set(r,e)})}_determineReadyState(t,e){return this.state.ready.get(t)!=null?"READY":j()-this.state.lastTimeout.get(t)<Ye?"POSSIBLE_TIMEOUT":this.state.wasReady.get(t)===!0?"PREV_READY":this.state.firstSeen.get(t)!=null?"NOT_READY":e?"UNKNOWN":"SEEN"}_getReadyStateAndTiming(t,e){let r=this._determineReadyState(t,e);return r==="READY"?{readyState:r,readyFor:j()-this.state.ready.get(t)}:{readyState:r}}getSlotReadyStateOnAdServerAdRequest(t,e){let{readyState:r,readyFor:o}=this._getReadyStateAndTiming(t,e);return r==="READY"?this.state.triggered.get(t)===!0?{readyState:"PREV_READY"}:(this.state.triggered.set(t,!0),{readyState:r,readyFor:o}):{readyState:r}}_onSlotRequested(t,e){let{readyState:r,readyFor:o}=this._getReadyStateAndTiming(t,e);this.state.ready.delete(t),this.validateAdRequests&&t.setUptSlotTargeting({[te]:["0"]}),this.plugins.onSlotRequested(t,r,o)}_forEachSlotScannedByAdRequest(t,e){this.core.get(S).getSlots().forEach(r=>{let o=this.state.firstSeen.get(r);o!=null&&o<=t.index&&e(r)})}enableAdRequestValidation(){if(!this.validateAdRequests)try{let t=this._processResourceRequest.bind(this);new PerformanceObserver(r=>r.getEntries().forEach(t)).observe({type:"resource"}),this.validateAdRequests=!0}catch(t){}}_processResourceRequest(t){var e,r,o;try{if(He.every(p=>!t.name.startsWith(p)))return;let l=(r=(e=new URL(t.name).searchParams.get("prev_scp"))==null?void 0:e.split("|"))!=null?r:[];for(let p of l){let T=((o=new URLSearchParams(p).get(te))==null?void 0:o[0])==="1";this.plugins.onSlotRequestValidated(T)}}catch(a){}}};i(D,"SlotReadinessTracker"),s([m(S,"slotScanned")],D.prototype,"_onSlotScanned",1),s([m(A,"adRequestBeforeRelease")],D.prototype,"_onAdRequestCompleted",1),s([m(A,"adRequestTimedOut")],D.prototype,"_onAdRequestTimedOut",1),s([m(S,"slotRequested")],D.prototype,"_onSlotRequested",1),D=s([c],D);var v=(h=>(h[h.ReadySlots="b10"]="ReadySlots",h[h.PrevReadySlots="b11"]="PrevReadySlots",h[h.SeenSlots="b12"]="SeenSlots",h[h.NotReadySlots="b13"]="NotReadySlots",h[h.UnknownSlots="b14"]="UnknownSlots",h[h.PossibleTimeoutSlots="b15"]="PossibleTimeoutSlots",h[h.TrackerIndex="d6"]="TrackerIndex",h[h.BatchStart="d7"]="BatchStart",h[h.NumTotalTimeouts="d9"]="NumTotalTimeouts",h[h.SlotReqAvgTimeSinceCall="d10"]="SlotReqAvgTimeSinceCall",h[h.SlotReqAvgTimeSinceDone="d11"]="SlotReqAvgTimeSinceDone",h[h.NumTotalSlotsRequestedOk="d12"]="NumTotalSlotsRequestedOk",h[h.NumTotalValidatedAdServerRequestsOk="d13"]="NumTotalValidatedAdServerRequestsOk",h[h.NumTotalValidatedAdServerRequestsNotOk="d14"]="NumTotalValidatedAdServerRequestsNotOk",h[h.NumTotalTimesTargetingRestored="d15"]="NumTotalTimesTargetingRestored",h[h.NumTotalAdRequestsCompleted="d16"]="NumTotalAdRequestsCompleted",h[h.NumTotalInternalAdRequestsCompleted="d17"]="NumTotalInternalAdRequestsCompleted",h[h.NumTotalSlotsRequested="d18"]="NumTotalSlotsRequested",h[h.NumSlotWithReducedTargeting="d19"]="NumSlotWithReducedTargeting",h[h.NumSlotsWithExtendedTargeting="d20"]="NumSlotsWithExtendedTargeting",h))(v||{}),$e="implcheck",We=1e-4,Xe=5e3,Je=5,L=class{constructor(){g(this,"enabled",!1);g(this,"totalInternalAdRequestQueuedCount",0);g(this,"totalAdRequestsCompletedCount",0);g(this,"totalSlotsRequestedCount",0);g(this,"totalSlotsRequestedOkCount",0);g(this,"totalTimeoutCount",0);g(this,"trackersSent",0);g(this,"totalValidatedAdServerRequests",{ok:0,notOk:0});g(this,"lastOnDvtagReadyCall",NaN);g(this,"slotReqAvgTimeSinceCall",new _t);g(this,"slotReqAvgTimeSinceDone",new _t);g(this,"batch",null)}isDebugForceEnabled(){return!1}_initialize(){this.enabled=this.core.get(L).isDebugForceEnabled()||Math.random()<We,this.enabled&&this.core.get(D).enableAdRequestValidation()}_onAdRequestQueued(t){this.enabled&&(this.lastOnDvtagReadyCall=j(),t.internal&&(this.totalInternalAdRequestQueuedCount+=1))}_onAdRequestCompleted(t){this.enabled&&(this.totalAdRequestsCompletedCount+=1,(t.status==="tag-timeout"||t.status==="queue-timeout")&&(this.totalTimeoutCount+=1))}_onSlotRequested(t,e,r){if(!this.enabled)return;let o=this._getOrStartBatch();this.totalSlotsRequestedCount+=1,e==="READY"&&(this.totalSlotsRequestedOkCount+=1),o.slots[e].push(t.elementId),r!=null&&(this.slotReqAvgTimeSinceDone.push(r),this.slotReqAvgTimeSinceCall.push(j()-this.lastOnDvtagReadyCall));let a=t.validateAdServerTargeting();a===1?o.targeting.extendedCount+=1:a===0&&(o.targeting.reducedCount+=1)}_onSlotRequestValidated(t){t?this.totalValidatedAdServerRequests.ok+=1:this.totalValidatedAdServerRequests.notOk+=1}_sendTracker(){let t=this.core.get(M).getRestoreCount(),{slots:e,targeting:r,start:o}=this._getOrStartBatch(),a={[v.ReadySlots]:e.READY.join(),[v.PrevReadySlots]:e.PREV_READY.join(),[v.SeenSlots]:e.SEEN.join(),[v.NotReadySlots]:e.NOT_READY.join(),[v.UnknownSlots]:e.UNKNOWN.join(),[v.PossibleTimeoutSlots]:e.POSSIBLE_TIMEOUT.join(),[v.TrackerIndex]:this.trackersSent,[v.BatchStart]:o,[v.NumTotalTimeouts]:this.totalTimeoutCount,[v.SlotReqAvgTimeSinceCall]:this.slotReqAvgTimeSinceCall.getRounded(),[v.SlotReqAvgTimeSinceDone]:this.slotReqAvgTimeSinceDone.getRounded(),[v.NumTotalSlotsRequestedOk]:this.totalSlotsRequestedOkCount,[v.NumTotalValidatedAdServerRequestsOk]:this.totalValidatedAdServerRequests.ok,[v.NumTotalValidatedAdServerRequestsNotOk]:this.totalValidatedAdServerRequests.notOk,[v.NumTotalTimesTargetingRestored]:t,[v.NumTotalAdRequestsCompleted]:this.totalAdRequestsCompletedCount,[v.NumTotalInternalAdRequestsCompleted]:this.totalInternalAdRequestQueuedCount,[v.NumTotalSlotsRequested]:this.totalSlotsRequestedCount,[v.NumSlotWithReducedTargeting]:r.reducedCount,[v.NumSlotsWithExtendedTargeting]:r.extendedCount};this.core.get(N).fireEvent($e,a,{flushToPxsrv:1}),this.batch=null,this.trackersSent+=1,this.trackersSent>=Je&&(this.enabled=!1)}_getOrStartBatch(){return this.batch==null&&(this.batch={start:j(),slots:Object.fromEntries(Object.values(Ot).map(t=>[t,[]])),targeting:{extendedCount:0,reducedCount:0}},setTimeout(()=>this._sendTracker(),Xe)),this.batch}};i(L,"ImplementationValidator"),s([P],L.prototype,"_initialize",1),s([m(A,"adRequestQueued")],L.prototype,"_onAdRequestQueued",1),s([m(A,"adRequestCompleted")],L.prototype,"_onAdRequestCompleted",1),s([m(D,"onSlotRequested")],L.prototype,"_onSlotRequested",1),s([m(D,"onSlotRequestValidated")],L.prototype,"_onSlotRequestValidated",1),L=s([c],L);var z=class{constructor(){g(this,"initialized",!1);g(this,"size",0)}_initialize(){return y(this,null,function*(){if(yield Promise.resolve(),this.initialized)return;this.initialized=!0,this.core.dvtag.cmd instanceof Array||(this.core.dvtag.cmd=[]);let t=this.core.dvtag.cmd;this.core.dvtag.cmd={push:(...e)=>{for(let r of e)try{r()}catch(o){}return this.size+=e.length,this.size}},this.core.dvtag.cmd.push(...t)})}};i(z,"CommandBuffer"),s([P],z.prototype,"_initialize",1),z=s([c],z);var ee="api",V=class{_defineSlot(t,e={}){this.core.get(S).createSlot(ee,t,ot(W({},e),{sizes:ct(e.sizes)}))}};i(V,"DefineSlot"),s([it("defineSlot")],V.prototype,"_defineSlot",1),V=s([c],V);var Y=class{_getTargeting(t){var r;let e=this.core.get(S);if(t==null)return e.getUptPageTargeting();{let o=e.getSlot(ee,t);return(r=o==null?void 0:o.getUptTargeting())!=null?r:e.getUptPageTargeting()}}};i(Y,"GetTargeting"),s([it("getTargeting")],Y.prototype,"_getTargeting",1),Y=s([c],Y);var ht=class{};i(ht,"HouseHold"),ht=s([c,I(A),I(z),I(V),I(Y),I(N),I(M)],ht);if(window.dvtag==null||window.dvtag._core==null)try{new St(Gt,window)}catch(n){}})();
